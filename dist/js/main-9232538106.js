!function t(e,n,i){function a(s,r){if(!n[s]){if(!e[s]){var u="function"==typeof require&&require;if(!r&&u)return u(s,!0);if(o)return o(s,!0);throw new Error("Cannot find module '"+s+"'")}var d=n[s]={exports:{}};e[s][0].call(d.exports,function(t){var n=e[s][1][t];return a(n?n:t)},d,d.exports,t,e,n,i)}return n[s].exports}for(var o="function"==typeof require&&require,s=0;s<i.length;s++)a(i[s]);return a}({1:[function(t,e,n){function i(e,n,i){var a,o=t("./template.js"),s=(t("../util/load.js")(),function(){}),r=function(t){var n=doT.template(o.listItem)(t),i=$(n);$(e).find(".js-users-list").append(i)},u=function(t,e){switch(e.type){case 102:r(e)}},d=function(t,i){a=n.getGlobal(),$(e).find("img.js-my-logo").attr("src",i.face),$(e).find(".js-customer-service").html(i.name)},l=function(){$(document.body).on("core.onload",d),$(document.body).on("core.receive",u)},c=function(){},f=function(){s(),l(),c()};f()}e.exports=i},{"../util/load.js":27,"./template.js":2}],2:[function(t,e,n){var i={};i.listItem='<li title="{{=it.uname}}" ><a href="javascript:;" class="user"  name="{{=it.uname}}" usource="0" data-uid="c8502966db3f40538794a4e9ab9a8c49"><i class="fa fa-laptop"><span class="newIcon"></span></i><span class="uname" style="width: 230px;">{{=it.uname}}</span><span class="lastMsg"><span style="color:#ffad01">sfsad</span></span><span class="badge badge-red msg-count"></span><i class="user-del"  style="display: none;"><span class="newIcon"></span></i><span class="ohide">{{=it.uname}}</span></a></li>',e.exports=i},{}],3:[function(t,e,n){function i(e){var n,i={},a="",o=1;alert(o);var s,r,u,d,l,c=t("./socket/json.js"),f=t("./socket/heartbeat.js"),p=t("../util/normatMessageAdapter.js"),h=t("./messagetype.json"),g=t("../util/promise.js"),m=e.Notification||e.webkitNotifications,v={},y=function(t,n){a=t.token||e.sessionStorage.getItem("temp-id"),n.resolve({})},j=function(){var t=location.href,e=t.substring(t.lastIndexOf("?")+1);e.lastIndexOf("#")>=0&&(e=e.substring(0,e.lastIndexOf("#")));for(var n=e.split("&"),i={},a=0;a<n.length;a++){var o=n[a],s=o.substring(0,o.indexOf("=")),r=o.substring(o.indexOf("=")+1);/^-?(\d+)(\.\d+)?$/.test(r)?i[s]=Number(r):"true"===r?i[s]=!0:"false"===r?i[s]=!1:i[s]=r}return i},b=function(){u.start()},x=function(){g.when(function(){var t=new g;return $.ajax({url:"getEnvironment",data:{},dataType:"json"}).success(function(e){t.resolve({token:e.token})}).fail(function(e){t.reject({token:null})}),t}).then(y,y).then(function(t,i){$.ajax({url:"/chat/admin/connect.action",dataType:"json",type:"get",data:{uid:n.id,way:1,st:n.st||1,lt:n.lt||(new Date).getTime(),token:a}}).done(function(t){if(1==t.status||2==t.status){for(var n in t)v[n]=t[n];v.baseUrl=location.protocol+"//"+location.host+"/chat/",$(".js-loading-layer").hide(),i.resolve(t)}else alert("登录失败"),$(e).unbind("beforeunload"),e.close(),e.location.href="/console/login"})}).then(function(t,e){new f(i).start(),r.trigger("core.onload",[v]),b()})},w=function(t){102===t.type&&l.play(),t.description=h[t.type]},T=function(t,e){var n=103==e?"用户"+t.uname+"发送了一条消息":"新用户上线了！",i=103==e?t.desc:t.uname,a=new m(n,{body:i,tag:e+t.uid});a.onclick=function(t){return function(){r.trigger("notification.click",[t])}}(t.uid),setTimeout(function(){a.close()},5e3)},k=function(t){for(var n=0,i=t.length;i>n;n++){var a=t[n];103===a.type?(d.play(),p(a),T(a,103)):109==a.type&&2==a.status?(alert("另外一个窗口已经登录，您被强迫下线！"),e.close(),e.location.href="/console/login/"):(w(a),T(a,102))}},C=function(){return v},I=function(){r=$(document.body)},_=function(){r.on("emergency.netclose",function(){alert("与服务器连接中断！"),$(e).unbind("beforeunload"),e.close(),e.location.href="/console/login"}),$(e).on("beforeunload",function(){return""})},S=function(){e.WebSocket,u=new c(v),u.on("receive",function(t){k(t),r.trigger("core.receive",[t])})},B=function(){m&&"granted"!==m.permission&&m.requestPermission().then(function(){s=m.requestPermission()})},q=function(){n=j();for(var t in n)v[t]=n[t];x(),S(),d=$("#audio1")[0],l=$("#audio2")[0],B()},L=function(){I(),_(),q()};return L(),i.getQueryParam=j,i.getGlobal=C,i}e.exports=i},{"../util/normatMessageAdapter.js":31,"../util/promise.js":32,"./messagetype.json":4,"./socket/heartbeat.js":5,"./socket/json.js":6}],4:[function(t,e,n){e.exports={102:"用户接入",103:"有新消息",108:"用户下线",109:"客服下线",110:"用户排队",111:"用户正在输入",112:"用户发送通话请求"}},{}],5:[function(t,e,n){function i(t){var e=t.getGlobal(),n=0,i=1e4,a=function(){$.ajax({url:"/chat/admin/msgt.action",type:"post",data:{pid:e.pid,uid:e.id},dataType:"json"}).success(function(){setTimeout(a,i)}).fail(function(t){n++,n>=6?$(document.body).trigger("emergency.netclose"):setTimeout(a,i)})};this.start=function(){a()}}e.exports=i},{}],6:[function(t,e,n){function i(t){var e,n={},i={answer:"",answerType:"",cid:"",docId:"",pid:"",questionId:"",uid:""},a=function(t,e){n[t]=e},o=function(n,a){$.ajax({url:"/chat/admin/send1.action",dataType:"json",type:"post",data:$.extend(i,{answer:a.answer,cid:a.cid,uid:t.id})}).success(function(){e.trigger("core.sendresult",[{token:a.date,type:"success"}])}).fail(function(){e.trigger("core.sendresult",[{token:a.date,type:"fail"}])})},s=function(e,n){var a=n.data;1!=n.status&&1!=n.stats||$.ajax({url:"/chat/admin/send1.action",dataType:"json",type:"post",data:$.extend(i,{answer:n.msg,cid:a.cid,uid:t.id})})},r=function(){e.on("textarea.send",o),e.on("rightside.onChatSmartReply",s)},u=function(t){for(var e=[],n=0;n<t.length;n++){var i=JSON.parse(t[n]);e.push(i)}return e},d=function(){$.ajax({url:"/chat/admin/msg.action",dataType:"json",type:"get",data:{puid:t.puid,uid:t.id}}).success(function(t){var e=u(t);n.receive&&n.receive(e)}).fail(function(t,e){}),setTimeout(d,1500)},l=function(){e=$(document.body)},c=function(){l(),r()};c(),this.on=a,this.start=d}e.exports=i},{}],7:[function(t,e,n){!function(e){var n=t("./core/core.js")(window),i=t("./leftside/index.js"),a=t("./rightside/main.js"),o=t("./textarea/index.js"),s=t("./chatlist/index.js"),r=t("./scrollcontent/index.js"),u=(t("./util/promise.js"),t("./util/modal/dialog.js"),t("./util/load.js")(),50),d=function(){},l=function(){var t=$(window).outerHeight()-u;$("#main-container").height(t),$("#chatlist").height(t),$("#left-navigation").height(t),i($("section#left-navigation")[0],n,window),a($(".rightBox")[0],n,window),o($(".js-TextArea"),n,window),s($("#chatlist"),n,window),r($("#chatlist"),n,window)},c=function(){$(window).on("resize",function(t){var e=$(window).outerHeight()-u;$("#main-container").height(e),$("#chatlist").height(e),$("#left-navigation").height(e)})},f=function(){d(),c(),l()};f()}(document.body)},{"./chatlist/index.js":1,"./core/core.js":3,"./leftside/index.js":9,"./rightside/main.js":18,"./scrollcontent/index.js":23,"./textarea/index.js":24,"./util/load.js":27,"./util/modal/dialog.js":29,"./util/promise.js":32}],8:[function(t,e,n){function i(e,n,i,a,o){var s,r,u,d,l,c,f,p,a=a||"online",h=n.getGlobal(),g=t("../util/normatMessageAdapter.js"),m={},v=(h.baseUrl,"history"==a?"offline":"online"),y=0,j=t("../util/load.js")(),b=t("../util/promise.js"),x=t("./source.json");this.token=+new Date;var w=function(t,n){var i=n.length>0?n[n.length-1]:null;if(e.uid!==o.getCurrentUid()){for(var a=0,s=n.length;s>a;a++){var r=n[a];r.cid===e.cid&&103==r.type&&y++}y>0?u.html(y).css({visibility:"visible"}):u.css({visibility:"hidden"})}i.cid==e.cid&&d.html(i?i.desc:"").addClass("orange")},T=function(){r.find(".js-icon").addClass("offline");var t=r.find(".js-user-status");t.css({display:"inline-block"}).html("[离线]"),v="offline"},k=function(){c.trigger("leftside.onremove",[{cid:e.cid,uid:e.uid}]),r.animate({height:0},300,function(){r.remove()})},C=function(){$.ajax({url:"/chat/admin/leave.action",data:{cid:e.cid,uid:h.id,userId:e.uid},type:"post",dataType:"json"}).success(function(t){1===t.status&&k()})},I=function(t){p||(p=$(i).find("ul.js-users-list"));var e=p.children();if(0==e.length)p.append(t);else{var n=e[0];t.insertBefore(n)}},_=function(){v="online";var t=r.find(".js-status");r.find(".js-icon").removeClass("offline"),t.css({display:"none"}).html("[离线]"),0!==r.index()&&I(r)},S=function(){var t=e.face,n=new Image;n.onload=function(){f.attr("src",t).css({display:"inline-block"})},n.src=t},B=function(){var t=new b,n=$(i).find('li[data-uid="'+e.uid+'"]');return n.length>0?(s=n[0],r=$(s),f||(f=r.find(".js-image-face")),S(),setTimeout(function(){t.resolve()},0)):j.load(h.baseUrl+"views/leftside/chatitem.html").then(function(n){e.source_type=x[e.usource],1==e.usource&&(e.imgUrl="img/weixinType.png"),e.face&&e.face.length&&(e.source_type="face");var i=doT.template(n)(e);r=$(i),f||(f=r.find(".js-image-face")),S(),I(r),t.resolve()}),t},q=function(){return v},L=function(){y=0,u.html("").css({visibility:"hidden"})},D=function(){var t=new b,n=e.uid;return m[n]?setTimeout(function(){t.resolve(m[n])},0):$.ajax({url:"/chat/admin/get_userinfo.action",dataType:"json",data:{sender:h.id,uid:e.uid}}).success(function(e){0==e.retcode&&(m[n]=e.data,t.resolve(e.data))}),t},O=function(){L(),r.addClass("active").siblings().removeClass("active"),e.from=a,e.status=v,b.when(D).then(function(t){e.uid!=o.getCurrentUid()&&$(document.body).trigger("leftside.onselected",[{data:e,userData:t}])})},z=function(t,n){if(n.data.uid==e.uid&&n.data.name){var i=n.data.name;l.html(i)}},N=function(t,n){"black"==n.type&&"add"==n.handleType&&n.userId===e.uid&&k(),"star"==n.type&&(delete m[e.uid],D())},R=function(t,n){n.uid==e.uid&&n.cid==e.cid&&(g(n),d.html(n.desc).removeClass("orange"))},U=function(t,e){e.uid;o.setCurrentUid(void 0),k()},G=function(){c.on("scrollcontent.onUpdateUserState",N),c.on("scrollcontent.onTransfer",U),c.on("core.receive",w),c.on("textarea.send",R),r.on("click",O),c.on("rightside.onProfileUserInfo",z)},P=function(){c=$(document.body),u=r.find(".js-unread-count"),p=$(i).find("ul.js-users-list"),d=r.find(".js-last-message"),l=r.find(".js-user-name")},A=function(){},E=function(){P(),G(),A()};B().then(function(){E()}),this.onOnline=_,this.getStatus=q,this.onRemove=C,this.onOffLine=T}e.exports=i},{"../util/load.js":27,"../util/normatMessageAdapter.js":31,"../util/promise.js":32,"./source.json":13}],9:[function(t,e,n){function i(e,n,i){var a,o,s,r,u,d,l,c,f,p={},h=(t("./template.js"),t("../util/load.js")()),g=t("./queue.js"),m=["","/chat/admin/online.action","/chat/admin/busy.action"],v=["","img/online.png","img/busy.png"],y=t("./online.js"),j=t("./offline.js"),b=t("../util/modal/alert.js"),x=function(){s=$(e),r=s.find(".js-menuDropdown"),u=s.find(".js-status-menu"),d=s.find(".js-status-image"),c=s.find(".js-wait-outer"),l=s.find(".js-invite-btn")},w=function(){new g(n,i)},T=function(){$.ajax({url:"/chat/admin/getAdminChats.action",type:"get",dataType:"json",data:{uid:f.id}}).success(function(t){I({count:t.waitSize})})},k=function(t){var e=$(t.currentTarget),n=e.index();e.addClass("active").siblings().removeClass("active"),0==n?(a.show(),o.hide()):(a.hide(),o.show())},C=function(t){var e=t.currentTarget,n=$(e).attr("data-status");u.removeClass("active");var a=m[n];if(2>=n&&n>0)$.ajax({url:a,type:"POST",dataType:"json",data:{uid:f.id}}).success(function(t){d.attr("src",v[n])});else{var o=new b({title:"提示",text:"请确定是否要下线？",OK:function(){$.ajax({url:"/chat/admin/out.action",type:"post",dataType:"json",data:{uid:f.id}}).success(function(t){1==t.status&&($(i).unbind("onbeforeunload"),i.location.href="/console/login")})}});o.show()}},I=function(t){h.load(f.baseUrl+"views/leftside/queuelength.html").then(function(e){var n=doT.template(e)(t);c.html(n)})},_=function(t,e){for(var n=0,i=e.length;i>n;n++){var a=e[n];switch(a.type){case 110:I(a)}}},S=function(t,i){f=n.getGlobal(),T(),d.attr("src",v[f.status]),$(e).find("img.js-my-logo").attr("src",i.face),$(e).find(".js-customer-service").html(i.name)},B=function(){$(document.body).on("core.onload",S),$(document.body).on("core.receive",_),$(document.body).on("click",function(){u.removeClass("active")}),s.delegate(".js-tab-item","click",k),r.on("click",function(t){t.stopPropagation(),u.toggleClass("active")}),s.delegate(".js-status","click",C),l.on("click",w)},q=function(){a=y(s.find(".js-chatonline")[0],n,i),o=j(s.find(".js-history-outer")[0],n,i)},L=function(){x(),B(),q()};return L(),p}e.exports=i},{"../util/load.js":27,"../util/modal/alert.js":28,"./offline.js":10,"./online.js":11,"./queue.js":12,"./template.js":14}],10:[function(t,e,n){function i(e,n,i){var a,o,s,r={},u=t("./source.json"),d=t("./chatItem.js"),l=["","noStar","noBlack"],c=t("../util/load.js")(),f=t("../util/promise.js"),p=0,h={},g=n.getGlobal(),m=["/chat/admin/get_histroryUser.action","/chat/admin/query_marklist.action","/chat/admin/query_blacklist.action"],v=function(){a=$(e),o=a.find(".js-history-list")},y=function(){return s},j=function(t){for(var e=0,n=t.length;n>e;e++){var i=t[e];i.source_type=u[i.source],console.log(i.source_type),1==i.source&&(i.imgUrl="img/weixinType.png"),i.uid=i.id}},b=function(t){var i=m[t];f.when(function(){var t=new f;return $.ajax({url:i,type:"get",dataType:"json",data:{uid:g.id}}).success(function(e){j(e);for(var n=0;n<e.length;n++){var i=e[n];h[i.uid]=i}t.resolve(e)}),t}).then(function(i,a){console.log(i),c.load(g.baseUrl+"views/leftside/chatlist.html").then(function(a){var s=l[t],u=doT.template(a)({list:i,type:"history",className:s});o.html(u);for(var c=0,f=i.length;f>c;c++){new d(i[c],n,e,"history",r)}})})},x=function(){},w=function(t){var e=$(t.currentTarget);e.addClass("active").siblings().removeClass("active");var n=e.index();b(n)},T=function(){a.show(),a.find(".js-switch-label").eq(p).trigger("click")},k=function(){a.hide()},C=function(){$(document.body).on("core.onload",x),a.delegate(".js-switch-label","click",w)},I=function(){},_=function(){v(),C(),I()};return _(),r.show=T,r.hide=k,r.getCurrentUid=y,r}e.exports=i},{"../util/load.js":27,"../util/promise.js":32,"./chatItem.js":8,"./source.json":13}],11:[function(t,e,n){function i(e,n,i){var a,o,s,r,u={},d={},l=t("./source.json"),c=t("./chatItem.js"),f=t("../util/modal/alert.js"),p=t("../util/load.js")(),h=function(){var t=0;for(var e in d)t++;0==t?a.addClass("noOnline"):a.removeClass("noOnline")},g=function(t){r=t},m=function(){return r},v=function(t,e){delete d[e.uid],h()},y=function(t){var i=t.uid;if(void 0===t.isTransfer&&(t.isTransfer=t.chatType),d[i]&&"offline"==d[i].getStatus())d[i].onOnline();else{var a=new c(t,n,e,null,u);d[t.uid]=a}h()},j=function(){a.hide()},b=function(){$.ajax({url:"/chat/admin/getAdminChats.action",dataType:"json",type:"get",data:{uid:s.id}}).success(function(t){if(t.userList.length>0)p.load(s.baseUrl+"views/leftside/chatlist.html").then(function(i){for(var a=0,o=t.userList.length;o>a;a++){var s=t.userList[a];void 0===s.isTransfer&&(s.isTransfer=s.chatType),1==s.usource&&(s.imgUrl="img/weixinType.png"),s.source_type=l[s.usource],s.face&&s.face.length&&(s.source_type="face")}var r=doT.template(i)({list:t.userList});$(e).find(".js-users-list").html(r);for(var a=0,o=t.userList.length;o>a;a++){var s=t.userList[a];d[s.uid]=new c(s,n,e,null,u)}});else{$(e).outerHeight();a.addClass("noOnline")}})},x=function(t,e){r=e.data.uid},w=function(t){var e=t.currentTarget,n=$(e).attr("data-uid");if(d[n]){var i=new f({title:"提示",text:"请确认顾客的问题已经解答，是否结束对话？",OK:function(){d[n].onRemove()}});i.show()}},T=function(t,e){for(var n=0,i=e.length;i>n;n++){var a=e[n];switch(a.type){case 102:y(a);break;case 108:_(a)}}},k=function(){a.show()},C=function(t,e){e!==r&&a.find('li[data-uid="'+e+'"]').trigger("click")},I=function(t,e){s=n.getGlobal(),b()},_=function(t){var e=t.uid;d[e]&&d[e].onOffLine()},S=function(){o.on("core.onload",I),o.on("core.receive",T),o.on("notification.click",C),o.on("leftside.onselected",x),o.on("leftside.onremove",v),a.delegate(".js-remove","click",w)},B=function(){a=$(e),o=$(document.body)},q=function(){},L=function(){B(),S(),q()};return L(),u.hide=j,u.getCurrentUid=m,u.setCurrentUid=g,u.show=k,u}e.exports=i},{"../util/load.js":27,"../util/modal/alert.js":28,"./chatItem.js":8,"./source.json":13}],12:[function(t,e,n){function i(e,n){var i,a,o,s,r,u,d,l,c,f,p,h,g=e.getGlobal(),m=t("../util/modal/dialog.js"),v=t("../util/load.js")(),y=t("../util/promise.js"),j=t("../util/datetime.js"),b=0,x=[0,0],w=["/chat/admin/queryUser.action","/chat/admin/queryVisitUser.action"],T=["views/leftside/queueitem.html","views/leftside/visitqueue.html"],k=1;this.token=+new Date;var C=function(t){var e=t.currentTarget,n=$(e).attr("data-index");k=1,b=n,$(e).addClass("active").siblings().removeClass("active"),_()},I=function(t,e){var n=t.html,o=t.data;o.isInvite=g.isInvite,x[b]=o.waitSize,h=o.countPage,o.currentTime=j.getTime(new Date);var s=doT.template(n)(o);return i.setInner(s),i.show(),a=$(i.getOuter()),q(),O(),setTimeout(e.resolve,0),e},_=function(){v.load(g.baseUrl+T[b]).then(B).then(function(t,e){h=t.data.countPage;var n=["waitSize","visitSize"],i=[d,l],a=t.data[n[b]];"number"==typeof a&&(i[b].html(a),x[b]=a),o.html(h),s.html(k),u.html(j.getTime(new Date));var r=doT.template(t.html)({list:t.data.list});f.html(r)})},S=function(){var t=p.val(),e=+t;0==t.length||isNaN(e)||(0>=e?e=1:e>=h&&(e=h),p.val(e),k=e,_())},B=function(t,e){var e=e||new y,n=t;return $.ajax({url:w[b],dataType:"json",type:"get",data:{uid:g.id,status:3,pageNow:k}}).success(function(t){t.currentPage=k,e.resolve({data:t,html:n})}),e},q=function(){s=a.find(".js-current-page"),o=a.find(".js-all-count-page"),r=a.find(".js-page-jump-btn"),p=a.find(".js-input"),c=a.find(".js-refresh-btn"),f=a.find(".js-table-outer"),u=a.find(".js-refresh-time"),d=a.find(".js-wait-size"),l=a.find(".js-visit-size")},L=function(t){var e=t.currentTarget;if(!$(e).hasClass("disabled")){var n=$(e).attr("data-uid");$.ajax({url:"/chat/admin/invite.action",dataType:"json",type:"post",data:{uid:g.id,userId:n}}).success(function(t){1==t.status&&(x[b],a.find(".js-size-btn").eq(b).html(--x[b]),$(e).html("已邀请").addClass("disabled").css({color:"#808080"}))}).fail(function(t,n){$(e).html("失败").addClass("disabled").css({color:"#808080"})})}},D=function(t){var e=t.currentTarget,n=$(e).attr("data-type");"prev"==n?k=1>=k?1:k-1:"next"==n&&(k=k>=h-1?h:k+1),_()},O=function(){a.delegate(".js-page-btn","click",D),r.on("click",S),a.delegate(".js-invite-btn","click",L),a.delegate(".js-queue-tab","click",C),c.on("click",function(){_()})},z=function(){i=new m({title:"选择排队用户",footer:!1}),v.load(g.baseUrl+"views/leftside/queuelist.html").then(function(t,e){return B(t,e)}).then(I).then(function(){$.ajax({url:w[1],dataType:"json",data:{},type:"post"}).success(function(t){x[1]=t.visitSize,a.find(".js-size-btn").eq(1).html(t.visitSize)})})},N=function(){z()};N()}e.exports=i},{"../util/datetime.js":26,"../util/load.js":27,"../util/modal/dialog.js":29,"../util/promise.js":32}],13:[function(t,e,n){e.exports=["laptop","weixin","app","","mobile"]},{}],14:[function(t,e,n){e.exports=t(2)},{}],15:[function(t,e,n){var i=function(e,n,i){var a,o,s,r,u,d=n.getGlobal(),l={showClientSys:null},c=t("../../util/load.js")(),f=t("../../util/promise.js"),p=function(){h();var t=new f;return $.ajax({type:"post",cache:!1,url:"admin/getIframe.action",data:{uid:d.id,userId:i.uid},dataType:"json",success:function(e){if(e.length<1)return void $(a).addClass("hide");if(1==e.length){$(a).removeClass("hide");for(var n=0;n<e.length;n++)for(var i in e[n])$(u).height($(".rightBox .tab-content").height()),$(u).width($(".rightBox .tab-content").width()),$(s).attr("addrurl",e[n][i]).attr("data-toggle","tab"),$(s).on("click",function(){$(u).attr("src",$(s).attr("addrurl")).ready()})}else{var o=$(s);if(c.load(d.baseUrl+"views/rightside/menutemp.html").then(function(t){var n=doT.template(t)({list:e});o.after(n)}),l.showClientSys)for(var r in e[l.showClientSys-1])$(u).attr("src",e[l.showClientSys-1][r]);else $(a).removeClass("hide")}t.resolve()}}),t},h=function(){a=$(e).find(".js-nav-tabs #clientSystem"),o=$(e).find(".js-tab-content #clientSystem"),s=$(a).find(".js-dropdown-toggle"),u=$(o).find("#clientSysIframe"),r=$(a).find(".js-dropdown-menu")},g=function(){$(r).hide(),$(r).on("click",function(){$(r).show()})},m=function(){},v=function(){g(),m()};p().then(function(){v()})};e.exports=i},{"../../util/load.js":27,"../../util/promise.js":32}],16:[function(t,e,n){var i=function(e,n,i){var a,o,s,r,u,d,l=(n.getGlobal(),{uid:""}),c=function(e){function n(e){if(""!==e.answer?(null===e.pid&&(e.pid=0),$(r).find("a").html(e.answer),$(r).find("a").attr("answerType",e.answerType),$(r).find("a").attr("docId",e.docId),$(r).find("a").attr("pid",e.pid),$(r).find("a").attr("questionId",e.questionId),$(o).show(),$(o).find("a").css("color","#f90")):$(o).find("a").css("color","#ddd"),null!==e.sugguestions){$(s).show(),$(u).find("ul").html("");for(var n=t("./template.js"),i=0;i<e.sugguestions.length;i++){var a=$.extend({num:i+1,question:i+1+"."+e.sugguestions[i].question}),d=doT.template(n.sugguestionsItem)(a);$(u).find("ul").append(d)}}}$(o).hide(),$(s).hide(),$(r).find("a")[0].innerHTML="",$(u).find("ul")[0].innerHTML="";var a="admin/internalChat1.action";$.ajax({type:"post",url:a,dataType:"json",data:{uid:i.id,requestText:e},success:function(t){n(t)}})},f=function(t,e){l.uid=e?e.userData.uid:"",l.cid=e?e.data.cid:""},p=function(t){var e=$(this),n={},i=$(r).find("a");""!==i.html()&&"3"!==i.attr("answerType")&&""!==l.uid&&""!==l.cid&&(e.hasClass("quickSendBtn")?(n.status="1",n.msg=$(r).find("a").html(),n.docid=$(r).find("a").attr("docid")):(n.status="2",n.txt=e.text(),n.msg=e.html()),n.uid=l.uid,n.cid=l.cid,$(document.body).trigger("rightside.onChatSmartReply",[{data:n}]))},h=function(){c($(a).find("input#quickSerch")[0].value),$(this).hide()},g=function(){c($(this).attr("list")),setTimeout(function(){$(a).find(".js-robotBackHideBtn").show()},100)},m=function(t){var e=$(this);0!==e.val().length&&13==t.keyCode&&(c(e.val()),$(a).find(".js-robotBackHideBtn").hide())},v=function(t,e){c(e.data)},y=function(t,n){var i=$(e).find(".js-panel-body .js-nav-tabs li#homeuser"),a=$(e).find(".js-panel-body .js-tab-content"),o=$(i).attr("id");$(i).addClass("active").siblings("li").removeClass("active"),$(a).find(".js-tab-pane").each(function(t,e){return $(e).attr("id")==o.toString()?($(e).addClass("active in").siblings("div").removeClass("active in"),$(e).find("input").val(n.str),void c(n.str)):void 0})},j=function(){a=$(e).find(".js-tab-pane#homeuser"),o=$(e).find(".js-homeUserBox .js-robotDirectHideBtn"),s=$(e).find(".js-homeUserBox .js-relevantSearchHideBtn"),r=$(e).find(".js-robotAnswer"),u=$(e).find(".js-robotSugguestions"),d=$(e).find(".js-robotBackHideBtn")},b=function(){$(document.body).on("leftside.onselected",f),$(document.body).on("scrollcontent.onSearchUserChat",y),$(document.body).on("rightside.onTabSwitch",v),$(d).on("click",h),$(a).delegate("#quickSerch","keyup",m),$(o).delegate("a.quickSendBtn","click",p),$(r).delegate("a","click",p),$(u).delegate("li","click",g)},x=function(t){},w=function(){x()},T=function(){j(),b(),w()};T()};e.exports=i},{"./template.js":17}],17:[function(t,e,n){var i={},a="<li list={{=it.num}}>{{=it.question}}</li>";i.sugguestionsItem=a,e.exports=i},{}],18:[function(t,e,n){function i(e,n,i){var a,o={version:"5.0"},s=n.getGlobal(),r=[];o.id=s.id;var u,d,l,c=($(i).height(),$(i).height()-50),f=t("./profileuser/index.js"),p=t("./messagesuser/index.js"),h=t("./homeuser/index.js"),g=t("./clientsystems/index.js"),m=function(t,e){$("#homeuser .homeUserBox").css("height",c-52-40-52+"px"),$(".rightQuickLeft,.rightQuickRight").css("height",c-52+"px"),$("#clientSysIframe").css("height",c-52+"px"),$(".js-tab-pane#profileuser").css("height",c-52+"px")},v=function(t,e){var n=$(t),i=n.attr("id");$(d).find(".js-tab-pane").each(function(t,e){$(e).attr("id")==i.toString()&&$(e).addClass("active in").siblings("div").removeClass("active in")}),n.addClass("active").siblings("li").removeClass("active");var a=$(d).find(".js-tab-pane#homeuser p.searchBot input");$(a).val(e)},y=function(){var t=$(this).attr("id"),e="";if(a)for(var n=0;n<r.length;n++){var i=r[n];if(i.uid==a.uid){var o=$(d).find(".js-tab-pane#homeuser p.searchBot input");i.item.zIndex=t,e=$(o).val(),i.item.homeuser=e}}v($(this),e)},j=function(t){for(var e=$(d).find(".js-tab-pane#homeuser p.searchBot input"),n=$(e).val(),i=0;i<r.length;i++){var a=r[i];a.uid==t&&(n=a.item.homeuser,$(u).find("li.js-menu").each(function(t,e){$(e).attr("id")==a.item.zIndex&&(v($(e),n),$(document.body).trigger("rightside.onTabSwitch",{data:n}))}))}},b=function(t){var e=$($(u).find("li")[0]).attr("id"),n=!0;if(t){for(var i=0;i<r.length;i++){var a=r[i];if(a.uid==t)return void(n=!1)}if(n){var o={uid:t,item:{zIndex:e,profileuser:"",messagesuser:"",homeuser:"",clientSystem:""}};r.push(o)}}},x=function(){for(var t=0;t<r.length;t++)if(a.uid==r[t].uid){var e=$(d).find(".js-tab-pane#homeuser p.searchBot input").val();r[t].item.homeuser=e}},w=function(t){13==t.keyCode&&x()},T=function(){x()},k=function(t,i){f($(".js-tab-pane#profileuser"),n,i),console.log(i),g(e,n,i),b(i.data.uid),j(i.data.uid),a=i.data},C=function(){u=$(e).find(".js-panel-body ul.js-nav-tabs"),d=$(e).find(".js-panel-body .js-tab-content"),$(e).find(".js-tab-pane#profileuser").addClass("showBg"),l=$(d).find(".js-tab-pane#homeuser p.searchBot")},I=function(){$(i).on("core.onload",m),$(u).on("click","li.js-menu",y),$(document.body).on("leftside.onselected",k),$(l).delegate("input","keyup",w),$(l).delegate("input","blur",T)},_=function(){p(e,n,o),h(e,n,o)},S=function(){C(),I(),_()};$(document.body).on("core.onload",function(t){S()})}e.exports=i},{"./clientsystems/index.js":15,"./homeuser/index.js":16,"./messagesuser/index.js":20,"./profileuser/index.js":22}],19:[function(t,e,n){var i=function(e,n,i){var a=(n.getGlobal(),i.fastData,i.id);i.repBtnType=!0;var o,s,r,u,d,l,c=this,f={l001:"确定删除该快捷分组？",l002:"确定删除该快捷回复？"},p=function(){o=e,s=$(o).find(".js-leftContent ul"),r=$(o).find(".js-rightContent ul"),u=$(o).find(".js-addNewGroup"),d=$(o).find(".js-addNewRep"),l=$(o).find(".js-content")},h=function(t){$(e).find(".js-quickContent ul li.detalBar span").removeClass("hide"),$($(e).find(".js-quickLeft ul li")[0]).find("span.upLeftGroup").addClass("hide"),$($(e).find(".js-quickRight ul li")[0]).find("span.upRightRep").addClass("hide"),t&&$(document.body).trigger("rightside.oReLoadRightGroup")},g=function(){var t=$(this);t.addClass("activeLine").siblings("li").removeClass("activeLine"),t.find("input").addClass("activeLine").parent("li").siblings("li").find("input").removeClass("activeLine");var e=$(r).find("li");$(e).removeClass("show");for(var n=0;n<e.length;n++)$(e[n]).attr("gid")==t.attr("gid")&&($(e[n]).addClass("show"),$(e[n]).find("input").removeClass("hide"));t.hasClass("activeLine")?$(d).show():$(d).hide()},m=function(){var t,e,n,i,o,s=$(this);"left"==s.siblings("input").attr("utype")?(t=f.l001,e=s.parent(".detalBar").attr("gid"),n="reply/delreplyGroup.action",i="groupId",o={groupId:e,userId:a}):(t=f.l002,e=s.parent(".detalBar").attr("qid"),n="quick/delquickReply.action",i="id",o={groupId:e,userId:a}),s.text("确认删除"),s.hasClass("sureDel")?e&&$.ajax({type:"post",url:n,data:o,dataType:"json",success:function(t){t.status&&(s.parent(".detalBar").animate({height:0},300,function(){s.parent(".detalBar").remove()}),h(!0))}}):s.addClass("sureDel")},v=function(){var t,e,n,i,o=$(this);"left"==o.siblings("input").attr("utype")?(t="reply/setTopGroup.action",n=o.parent(".detalBar").attr("gid"),e="groupId",i={groupId:n,userId:a}):(t="quick/setTopReply.action",n=o.parent(".detalBar").attr("qid"),e="id",i={id:n,userId:a}),e&&$.ajax({type:"post",url:t,data:i,dataType:"json",success:function(t){if(t.status){var e=o.parent("li"),n=o.parents("ul");$(e).find("input").animate({height:35},200,function(){$(n).prepend(e),$(e).find("input").css("height",30)}),h(!0)}}})},y=function(t){var e=$(this),n=t.which;return 13!=n||t.shiftKey?void 0:(e.blur(),!1)},j=function(t){$(s).find("li").hasClass("activeLine")?$(d).show():$(d).hide();var e=$(this);if(""===e.val().replace(/(^\s*)|(\s*$)/g,"")||null===e.val()||void 0===e.val()){var n=e.parent("li.detalBar").attr("gid");return void(n?e.val(c.inputText):e.parent("li.detalBar").remove())}e.val()!=c.inputText&&("left"==e.attr("utype")?T.onFastLeftBlurSaveData(e):T.onFastRightBlurSaveData(e))},b=function(){c.inputText=$(this).val()},x=function(){i.repBtnType=!1},w=function(n){$(e).find(".js-content ul li").find("input").removeClass("newInput");var i,a,o,u="js-addNewGroup"===n.target.className?s:r;u==s?(i="delLeftGroup",a="upLeftGroup",o="left"):(i="delRightGroup",a="upRightGroup",o="right");var d=t("./template.js"),l=$.extend({utype:o,clsDelName:i,clsUpName:a}),c=doT.template(d.zcReplyOuter)(l),f=$(u).find("li")[$(u).find("li").length-1];$(u).find("li").length>0?$(f).find("input").val()?($(u).append(c),$(e).find(".js-content li input.newInput").focus()):$(f).remove():$(u).append(c)},T={onFastLeftBlurSaveData:function(t){var e=$(t),n=e.parent("li.detalBar").attr("gid"),i=$(t).val().replace(/(^\s*)|(\s*$)/g,"");if(n){var o="reply/updreplyGroup.action";$.ajax({type:"post",url:o,data:{groupId:n,groupName:i,userId:a},dataType:"json",success:function(e){e.status&&(h(!0),$(t).val(i))}})}else{var s="reply/addreplyGroup.action";$.ajax({type:"post",url:s,data:{groupName:i,userId:a},dataType:"json",success:function(t){t.status&&h(!0)}})}},onFastRightBlurSaveData:function(t){var e=$(t),n=e.parent(".detalBar"),i=($(n).index(),$(n).attr("gid")),o=e.val(),r=n.attr("qid");if(r){var u="quick/updquickReply.action";$.ajax({type:"post",url:u,data:{id:r,value:o,userId:a},dataType:"json",success:function(t){t.status&&h(!0)}})}else{var d=$(s).find("li");if($(s)&&d.length>0)for(var l=0;l<d.length;l++)$(d[l]).hasClass("activeLine")&&(i=$(d[l]).attr("gid"));var c="quick/addquickReply.action";$.ajax({type:"post",url:c,data:{groupId:i,value:o,userId:a},dataType:"json",success:function(t){t.status&&h(!0)}})}}},k=function(){$(e).find(".delLeftGroup").removeClass("sureDel"),$(e).find(".delRightRep").removeClass("sureDel"),$(s).find(".delLeftGroup").text("删除"),$(r).find(".delLeftRep").text("删除")},C=function(){x(),$(s).on("click","li",g),$(s).on("click","span.delLeftGroup",m),$(s).on("click","span.upLeftGroup",v),$(s).on("keypress","input",y),$(s).on("blur","input",j),$(s).on("focus","input",b),$(r).on("click","span.delRightRep",m),$(r).on("click","span.upRightRep",v),$(r).on("keypress","input",y),$(r).on("blur","input",j),$(r).on("focus","input",b),$(u).on("click",w),$(d).on("click",w),$(s).delegate("li","mouseleave",k)},I=function(){$(e).find(".js-content .js-leftContent li.activeLine").length<=0?$(d).hide():$(d).show()},_=function(){p(),C(),h(),I()};_()};e.exports=i},{"./template.js":21}],20:[function(t,e,n){var i=function(e,n,i){function a(){c(h.shadowNode,n,i),h.dialog.show()}var o,s,r,u,d=n.getGlobal(),l=t("../../util/load.js")(),c=t("./fastLayer.js"),f=t("../../util/modal/dialog.js"),p=t("../../util/promise.js"),h={},g=function(){o=$(e).find(".js-panel-body .js-tab-pane#messagesuser .js-shortcut"),s=$(e).find(".js-rightQuickLeft ul"),r=$(e).find(".js-rightQuickLRight ul"),u=$(".zc-shadow-layer .modal-dialog")},m=function(){var t=$(this).html();$(document.body).trigger("rightside.onSelectedByFastRelpy",[{data:t}])},v=function(){var t=$(this),e=$(r).find("li");$(e).removeClass("active");for(var n=0;n<e.length;n++)$(e[n]).attr("gid")==t.attr("gid")&&$(e[n]).addClass("active")},y=function(t){$(s).html(""),$(r).html(""),l.load(d.baseUrl+"views/rightside/fastreplyleft.html").then(function(e){var n=doT.template(e)({list:t});$(s).append(n)}),l.load(d.baseUrl+"views/rightside/fastreplyright.html").then(function(e){var n=doT.template(e)({list:t});$(r).append(n)})},j=function(){$.ajax({type:"post",cache:!1,data:{userId:i.id},url:"reply/replyGrouplist.action",dataType:"json",success:function(t){y(t)}})},b=function(t){var n=t||[];t||($(e).find(".js-rightQuickLeft ul").html(""),$(e).find(".js-rightQuickRight ul").html("")),l.load(d.baseUrl+"views/rightside/fastreplylayer.html").then(function(t){var e=doT.template(t)({list:n});h.dialog=new f({title:"快捷回复",footer:!1}),h.dialog.setInner(e),h.shadowNode=h.dialog.getOuter()})},x=function(){var t=new p,e="reply/replyGrouplist.action";
return $.ajax({type:"post",cache:!1,data:{userId:i.id},url:e,dataType:"json",success:function(e){i.fastData=e,t.resolve(),b(e)}}).fail(function(e,n){"parsererror"===n&&(i.fastData=[],b(),t.resolve())}),t},w=function(){y(i.fastData)},T=function(){$(s).on("click","li",v),$(r).on("click","li",m),$(o).on("click",a),$(document.body).on("rightside.oReLoadRightGroup",j)},k=function(){g(),T(),w()};x().then(function(){k()})};e.exports=i},{"../../util/load.js":27,"../../util/modal/dialog.js":29,"../../util/promise.js":32,"./fastLayer.js":19}],21:[function(t,e,n){var i={},a='<li class="detalBar"><input utype="{{=it.utype}}" type="text" class="newInput" placeholder="请输入..." ><span class="{{=it.clsDelName}}">删除</span><span class="{{=it.clsUpName}}" >置顶</span></li>';i.zcReplyOuter=a,e.exports=i},{}],22:[function(t,e,n){var i=function(e,n,i){var a=n.getGlobal(),o=i,s={},r=[],u=t("../../util/load.js")(),d=t("../../util/promise.js");String.prototype.visualLength=function(){var t=$(".aChat");return t.text(this),t[0].offsetWidth};var l=function(t,e){if(!t&&!e)return"-";var n=/^(https?)/;return t&&(t.match(n)||(t="http://"+t)),t&&!e?'<a target="_black" class="aChat" style="font-size:14px;" href="'+t+'" title="'+t+'">'+t+"</a>":!t&&e?e:'<a target="_black" class="aChat" style="font-size:14px;" href="'+t+'" title="'+e+'">'+e+"</a>"},c=function(){var t=new d;return o&&($(e).html("").removeClass("showBg"),u.load(a.baseUrl+"views/rightside/profileUser.html").then(function(n){o.userData.visit=l(o.userData.visitUrl,o.userData.visitTitle);var i=doT.template(n)({item:o});$(e).append(i),$(e).find("#sex").val(o.userData.sex),t.resolve()})),t},f=function(t,e){var n="admin/modify_userinfo.action",i={},a=$(e).attr("otype"),o={};i.uid=s.uid,i.sender=s.url_id,a&&(i[a]=t),$.ajax({type:"post",url:n,data:i,dataType:"json",success:function(n){$(e).val(t),o.status=!0,o.uid=s.uid,$(e).hasClass("userNameDyy")?o.name=t:o.name="",$(document.body).trigger("rightside.onProfileUserInfo",[{data:o}])}})},p={This:this,onTextBlurRegex:function(){var t=$($(this)[0]),e=!1;if(t){var n=t.val().trim().replace(/[ ]/g,""),i=r[t.attr("otype")];!function(t,n,i){var a=!0;if(p.This.inputText==n)e=!1;else{for(var o=0;o<t.length;o++){var s=t[o];if(!s.regex.test(n)){a=!1,i.addClass("warm"),i.val(p.This.inputText);var r=i.siblings("span.tip");r.find(".alerticon").text(s.alert);var u=i.offset().top-68,d=63;r.css({left:d+"px",top:u+"px"}).addClass("show").on("click",function(){$(this).removeClass("show"),i.removeClass("warm")});break}}a&&(i.siblings("span.tip").removeClass("show").find(".alerticon").text(""),i.removeClass("warm"),e=!0)}e&&f(n,i)}(i,n,t)}},onTextFocusRegex:function(){p.This.inputText=$(this).val(),$(this).select()}},h=function(){var t=$(this).find("option:selected").val();f(t,$(this)[0])},g=function(){var t=$(".aChat");if(t.length>0){var e=$(".chatWarp").width(),n=$(".aChat").text($(".aChat").text())[0].offsetWidth;n>=e?$(".chatWarpi").addClass("show"):$(".chatWarpi").removeClass("show")}},m=function(){},v=function(){$(e).delegate(".js-userTnp","blur",p.onTextBlurRegex),$(e).delegate(".js-userTnp","focus",p.onTextFocusRegex),$(e).delegate("#sex","change",h),$(e).find("#dp").datepicker()},y=function(){g()},j=function(){s.uid=o.data.uid,s.url_id=a.id,r={uname:[{regex:/\S/,alert:"不允许为空"},{regex:/\w{5,28}/,alert:"长度错误"}],realname:[{regex:/\S/,alert:"不允许为空"},{regex:/\w{5,28}/,alert:"格式错误"}],tel:[{regex:/\S/,alert:"不允许为空"},{regex:/^[0-9]{8,13}$/,alert:"格式错误"}],birthday:[{regex:/\S/,alert:"不允许为空"},{regex:/^[1-2][0-9]{3}\-(([0-2]{1}[0-9]{1})|(3[0-1]{1}))(\-([0-2]{1}[0-9]{1})|(3[0-1]{1}))*$/,alert:"格式错误"}],email:[{regex:/\S/,alert:"不允许为空"},{regex:/^[a-zA-Z0-9]+([-_\.][a-zA-Z0-9]+)*(?:@(?!-))(?:(?:[a-zA-Z0-9]*)(?:[a-zA-Z0-9](?!-))(?:\.(?!-)))+[a-zA-Z]{2,}$/,alert:"格式错误"}],qq:[{regex:/\S/,alert:"不允许为空"},{regex:/[1-9][0-9]{4,13}/,alert:"格式错误"}],weixin:[{regex:/\S/,alert:"不允许为空"},{regex:/\w{5,28}/,alert:"格式错误"}],weibo:[{regex:/\S/,alert:"不允许为空"},{regex:/\w{5,28}/,alert:"格式错误"}],remark:[{regex:/\S/,alert:"不允许为空"},{regex:/\w{0,200}/,alert:"格式错误"}]}};c().then(function(){b()});var b=function(){j(),m(),v(),y()}};e.exports=i},{"../../util/load.js":27,"../../util/promise.js":32}],23:[function(t,e,n){function i(e,n,i){var a,o,s=t("../util/load.js")(),r=t("../util/modal/dialog.js"),u=t("../util/modal/alert.js"),d=t("../util/qqFace.js"),l={},c={http:{chatList:{chat:"admin/get_chatdetail.action",hchat:"admin/get_chatdetail.action"},status:{black:{add:"admin/add_blacklist.action",del:"admin/delete_blacklist.action"},star:{add:"admin/add_marklist.action",del:"admin/delete_marklist.action"}},getOtherAdmin:"admin/getOhterAdminList.action",userTransfer:"admin/transfer.action",searchChat:"admin/internalChat1.action"},tpl:{chatList:"views/scrollcontent/list.html",chatItem:"views/scrollcontent/item.html",chatItemByAdmin:"views/scrollcontent/itemByAdmin.html",adminTable:"views/scrollcontent/adminTable.html",userReadySend:"views/scrollcontent/userReadySend.html"}},f={0:"http://img.sobot.com/chatres/common/face/pcType.png",1:"http://img.sobot.com/chatres/common/face/weixinType.png",2:"http://img.sobot.com/chatres/common/face/appType.png",3:"http://img.sobot.com/chatres/common/face/weiboType.png",4:"http://img.sobot.com/chatres/common/face/moType.png",5:"http://img.sobot.com/chatres/common/face/moType.png"},p={};$(document.body).on("textarea.send",function(t){q(arguments[1])}),$(document.body).on("leftside.onselected",function(){var t=arguments[1];p={isStar:!!t.userData.ismark,isBlack:!!t.userData.isblack,isTransfer:!!t.userData.chatType,cid:t.data.cid,uid:o.id,pid:t.data.pid,sender:o.id,userId:t.data.uid,userSourceImage:f[t.data.usource|t.data.source]},a.find("#chat").show(),a.find("#chat").find(".zc-newchat-tag").hide(),a.find("#chat").find(".js-user-ready-input").hide(),$(i).resize(),v("chat",T,null,null,{uid:t.data.uid,pid:t.data.pid},!0,!0),I({star:!!t.userData.ismark,black:!!t.userData.isblack,transfer:!!t.userData.chatType})}),$(document.body).on("leftside.onremove",function(){w(arguments[1].uid)}),$(document.body).on("rightside.onChatSmartReply",function(){console.log(arguments[1]);var t={answer:arguments[1].data.msg,uid:p.userId,pid:p.pid};"1"===arguments[1].data.stats&&q(t)});var h=function(t){$(document.body).trigger("scrollcontent.onSearchUserChat",[{uid:p.userId,str:t}])},g=function(t,e){$(document.body).trigger("scrollcontent.onUpdateUserState",[{type:t,handleType:e,userId:p.userId}])},m=function(t,e){w(),$(document.body).trigger("scrollcontent.onTransfer",[{uid:t,userName:e}])},v=function(t,e,n,i,a,o,s,r){var u;"function"==typeof arguments[0]&&(e=arguments[0],t="chat"),u=$.isArray(a)?a[0].uid:a.uid,l[u]?n?$.ajax({url:c.http.chatList[t],dataType:"json",type:"get",data:{t:l[u].date||Date.parse(new Date),uid:u,pid:a.pid,pageNow:n||1,pageSize:i||20}}).success(function(e){var n=[];e.data.length>0&&(e.data.map(function(t){n.push({action:"dateline",date:t.date}),t.content.map(function(t){t.msg=t.msg?d.analysis(t.msg):null,n.push(t)})}),n=n.concat(l[u].list),l[u].list=n,e.data[0]&&e.data[0].content[0]&&(l[u].date=e.data[0].content[0].t),o&&k(t,l[u],s,!0,r))}):o&&k(t,l[u],s,!1,r):(l[u]={},$.ajax({url:c.http.chatList[t],dataType:"json",type:"get",data:{t:l[u].date||Date.parse(new Date),uid:u,pid:a.pid,pageNow:n||1,pageSize:i||20}}).success(function(n){n.data[0]&&n.data[0].content[0]&&(l[u].date=n.data[0].content[0].t),e&&e(t,n,u,s)}))},y=function(t,e,n){var i=function(){$.ajax({url:c.http.status[t][e],dataType:"json",type:"get",data:{sender:p.sender,receiver:p.userId}}).success(function(i){n&&n(t,e)})};if("star"===t&&"add"===e)i();else{var a=new u({title:"提示",text:"请确定是否要改变状态？",OK:function(){i(),a.hide()}});a.show()}},j=function(t,e){$.ajax({url:c.http.getOtherAdmin,dataType:"json",type:"get",data:{uid:t}}).success(function(t){var n=new r({title:"转接给新的客服",footer:!1});n.show(),s.load(o.baseUrl+c.tpl.adminTable).then(function(i){var a;a=doT.template(i)({list:t}),n.setInner(a),e&&e(n)})})},b=function(t){$(t.getOuter()).find(".js-transfer-href").on("click",function(){var e=$(this).attr("uid"),n=$(this).attr("uname");$.ajax({url:c.http.userTransfer,dataType:"json",type:"get",data:{uid:p.sender,cid:p.cid,joinUid:e,userId:p.userId,userName:n}}).success(function(i){1===i.status&&t.hide(),m(e,n)})})},x=function(){a.on("click",".formUser",function(){var t=$(this).html();-1!==t.indexOf("webchat_img_upload")?i.open():h(t)})},w=function(t){a.find("#chat").hide(),l[p.userId|t]=void 0,a.find(".js-addButton").children(".js-goOut").addClass("hide"),a.find("#chat").find(".js-panel-body").empty()},T=function(t,e,n,i){s.load(o.baseUrl+c.tpl.chatList).then(function(o){var s,r=[];e.data.map(function(t){r.push({action:"dateline",date:t.date}),t.content.map(function(t){t.msg=t.msg?d.analysis(t.msg):null,r.push(t)})}),l[n]={list:r,scrollTop:0,pageNo:1},s=doT.template(o)({userSourceImage:p.userSourceImage,list:r}),a.find("#"+t).find(".js-panel-body").empty().html(s),i&&a.find("#"+t).find(".js-panel-body")[0].scrollIntoView(!1)})},k=function(t,e,n,i,r){s.load(o.baseUrl+c.tpl.chatList).then(function(o){var s;if(s=doT.template(o)({userSourceImage:p.userSourceImage,list:e.list}),a.find("#"+t).find(".js-panel-body").html(s),n)a.find("#"+t).find(".js-panel-body")[0].scrollIntoView(!1);else if(i)a.find("#"+t).find(".js-panel-body").parent().scrollTop(10);else{var u=a.find("#"+t).find(".js-panel-body").parent()[0].scrollHeight,d=a.find("#"+t).find(".js-panel-body").parent().scrollTop();u-d>700?103===r&&a.find("#"+t).find(".zc-newchat-tag").show():a.find("#"+t).find(".js-panel-body")[0].scrollIntoView(!1)}})},C=function(t,e){a.find(".js-addButton").children('[data-type="'+t+'"]').removeClass("hide"),a.find(".js-addButton").children(".js-"+t+"-"+e).addClass("hide"),"black"===t&&"add"===e&&w(),B({type:t,handleType:e}),g(t,e)},I=function(t){a.find(".js-addButton").children("a").addClass("hide");for(var e in t)"transfer"===e?t[e]&&a.find(".js-addButton").children(".js-transfer").removeClass("hide"):a.find(".js-addButton").children(".js-"+e+"-"+(t[e]?"del":"add")).removeClass("hide");a.find(".js-addButton").children(".js-transfer").removeClass("hide")},_={102:function(t){t.userHeadImage=f[t.source],t.t=new Date(t.t).toLocaleString().split(" ")[1]},103:function(t){t.userHeadImage=f[t.source],t.ts=t.ts.split(" ")[1]},108:function(t){t.t=new Date(t.t).toLocaleString().split(" ")[1]},111:function(t){}},S=function(t){if(_[t.type]&&_[t.type](t),111===t[0].type)s.load(o.baseUrl+c.tpl.userReadySend).then(function(e){var n;n=doT.template(e)({data:t[0]}),a.find("#chat").find(".js-user-ready-input").empty().append(n),setTimeout(function(){a.find("#chat").find(".js-user-ready-input").hide()},5e3)});else if(108===t[0].type)w();else if(l[t[0].uid]){for(var e=0;e<t.length;e++)103===t[e].type&&l[t[0].uid].list.push({action:5,senderType:0,senderName:t[e].uname,msg:t[e].content,ts:t[e].ts});var n=p.userId===t[0].uid;v("chat",k,null,null,t,n,!1,t[0].type)}},B=function(t){var e={star:{add:{action:16},del:{action:17}},black:{add:{},del:{action:12}}},n=e[t.type][t.handleType];n.ts="date "+(new Date).toTimeString().split(" ")[0],n.senderName=o.name;var t={uid:p.userId,pid:p.pid};l[p.userId]=l[p.userId]||{list:[],scrollTop:0,pageNo:1},l[p.userId].list.push(n),v("chat",k,null,null,t,!0,!0)},q=function(t){l[t.uid]=l[t.uid]||{list:[],scrollTop:0,pageNo:1},l[t.uid].list.push({action:5,senderType:2,senderName:o.name,msg:t.answer?d.analysis(t.answer):null,ts:"date "+(new Date).toTimeString().split(" ")[0]});var e=p.userId===t.uid;v("chat",k,null,null,t,e,!0)},L=function(){a=$(e)},D=function(t,e){S(e)},O=function(t,e){o=n.getGlobal()},z=function(){$(document.body).on("core.onload",O),$(document.body).on("core.receive",D),a.find(".js-addButton").on("click",".js-goOut",function(t){var e=$(this),n=e.attr("data-type"),i=e.attr("data-handle");n||i?y(n,i,C):j(p.sender,b)}),a.find("#chat").find(".scrollBoxParent").scroll(function(t){0===$(this).scrollTop()&&(l[p.userId].pageNo++,v("chat",T,l[p.userId].pageNo,null,{uid:p.userId,pid:p.pid},!0,!1))}),a.find("#chat").on("click",".zc-newchat-tag",function(){a.find("#chat").find(".js-panel-body")[0].scrollIntoView(!1),a.find("#chat").find(".zc-newchat-tag").hide()}),x()},N=function(){},R=function(){L(),z(),N()};R()}e.exports=i},{"../util/load.js":27,"../util/modal/alert.js":28,"../util/modal/dialog.js":29,"../util/qqFace.js":33}],24:[function(t,e,n){function i(e,n,i){var a,o,s,r,u,d=(t("../util/load.js")(),t("../util/qqFace.js")),l=t("./uploadImg.js"),c=function(){o=$(e),s=o.find(".js-upload"),$sendMessage=o.find(".js-sendMessage"),$botTextBox=o.find(".js-botTextBox")},f=function(t){var e=doT.template(template.listItem)(t),n=$(e);o.find(".js-users-list").append(n)},p=function(t,e){switch(e.type){case 102:f(e)}},h=function(t,e){u=e.data.uid,r=e.data.cid,"online"==e.data.from?($botTextBox.show(),w()):"history"==e.data.from&&($botTextBox.hide(),w())},g=function(t,e){$(document.body).trigger("textarea.send",[{answer:'<img class="webchat_img_upload upNowImg" src="'+e.url+'" />',uid:u,cid:r,date:+new Date}])},m=function(){var t=$sendMessage.val();$(document.body).trigger("textarea.send",[{answer:t,uid:u,cid:r,date:+new Date}]),$sendMessage.val("")},v=function(t,e){"2"==e.data.stats&&$sendMessage.val(e.data.msg).focus()},y=function(t,e){$sendMessage.val(e.data).focus()},j=function(t){var e=$sendMessage.val();if(console.log(e),13==t.keyCode){if(0==e.length||/^\s+$/g.test(e))return!1;m(),(/^\n+$/g.test(e)||/^\r+$/g.test(e))&&$sendMessage.val("")}},b=function(t,e){o.find("img.js-my-logo").attr("src",e.face),o.find(".js-customer-service").html(e.name)},x=function(){a.onChangeHandler(u,r)},w=function(){var t=$botTextBox.height(),e=1;switch("block"==o.find(".js-botTextBox").css("display")&&(e=2),e){case 1:$(".scrollBoxParent").height($(i).height()-102+"px");break;case 2:$(".scrollBoxParent").height($(i).height()-(102+t)+"px")}$botTextBox.css("bottom","-230px")},T=function(){$botTextBox.hide()},k=function(){$(document.body).on("core.onload",b),$(document.body).on("core.receive",p),$(document.body).on("leftside.onselected",h),$(document.body).on("textarea.uploadImgUrl",g),$(document.body).on("rightside.onSelectedByFastRelpy",y),$(document.body).on("rightside.onChatSmartReply",v),$(i||document.body).on("resize",w),o.find(".js-btnSend").on("click",m),$sendMessage.on("keydown",j),o.find(".js-emotion").on("click",I),o.find(".icoLi").on("click",_),o.find(".js-upload").on("change",x)},C=function(){d.initConfig({saytext:".js-sendMessage",Group:"#faceGroupTarea",faceGroup:"#faceGroup",emojiGroup:"#emojiGroup",emotion:".js-emotion",path:"chatres/common/emotes/qqarclist/",emojiPath:"chatres/common/emotes/emoji/"},function(){})},I=function(){o.find("#faceGroup").show(),o.find("#emojiGroup").hide(),o.find(".icoLi").removeClass("active"),o.find(".firsticoLi").addClass("active"),d.show(),d.emojiShow()},_=function(){$(this).addClass("active").siblings().removeClass("active"),o.find(".groupChildren").hide();var t=$(this).attr("data-src");$(t).show()},S=function(){a=l(s,e,n,i),C(),o.find(".item").perfectScrollbar(),T(),w()},B=function(){c(),k(),S()};B()}e.exports=i},{"../util/load.js":27,"../util/qqFace.js":33,"./uploadImg.js":25}],25:[function(t,e,n){function i(e,n,i,a){var o={},s=(t("../util/upload.js"),t("../util/modal/alert.js")),r=function(){$node=$(n),$uploadBtn=$node.find(".js-upload")},u=function(t,e){d(t,e)},d=function(t,e){if(FormData)l(t,e);else{var n=new FormData,i=$uploadBtn[0];if(c()){for(var a=0;a<i.files.length;a++){var o=i.files[a];n.append(o.name,o)}$.ajax({url:"/chat/webchat/fileupload.action",type:"POST",data:n,processData:!1,contentType:!1}).success(function(n){var i=n.url;$(document.body).trigger("textarea.uploadImgUrl",[{uid:t,cid:e,url:i}])}).fail(function(t){console.log("fail")})}$uploadBtn.val("")}},l=function(t,e){var n=$node.find(".js-fileinfo");if(c()){var i="iframe"+ +new Date;n.attr("target",i),n.attr("action","/chat/webchat/fileupload.action");var a=$('<iframe id="'+i+'" style="display:none;" name="'+i+'"></iframe>');a.on("load",function(){var n=a[0],i=n.contentWindow.document.body.getElementsByTagName("pre")[0],o=JSON.parse(i.innerHTML);console.log(o),$(document.body).trigger("textarea.uploadImgUrl",[{uid:t,cid:e,url:o.url}])}),$(document.body).append(a),n.submit()}$uploadBtn.val("")},c=function(){var t=$uploadBtn.val(),e=t.substr(t.indexOf(".")),n=/^(.jpg|.JPG|.png|.PNG|.gif|.GIF|.txt|.TXT|.DOC|.doc|.docx|.DOCX|.pdf|.PDF|.ppt|.PPT|.pptx|.PPTX|.xls|.XLS|.xlsx|.XLSX|.RAR|.rar|.zip|.ZIP|.mp3|.MP3|.mp4|.MP4|.wma|.WMA|.wmv|.WMV|.rmvb|.RMVB)$/;if(n.test(e))return!0;var i=new s({title:"提示",text:"上传格式不正确",OK:function(){},footer:!1});return i.show(),!1},f=function(){},p=function(){r(),f()};return p(),o.onChangeHandler=u,o}e.exports=i},{"../util/modal/alert.js":28,"../util/upload.js":34}],26:[function(t,e,n){var i={},a=function(t){return t>=10?t+"":"0"+t},o=function(t){if(Object.prototype.toString.call(t).indexOf("Date")<0)throw"param error";var e=t.getHours(),n=t.getMinutes(),i=t.getSeconds(),o=[a(e),a(n),a(i)];return o.join(":")};i.getTime=o,e.exports=i},{}],27:[function(t,e,n){var i=t("./promise.js"),a={},o={},s=function(t,e){var e=e||new i;if(o[t])return i.when(function(){var e=o[t],n=new i;return setTimeout(function(){n.resolve(e)},0),n});var e=i.when(function(){return $.ajax({url:t,dataType:"text",type:"get"}).success(function(n){e.resolve(n),o[t]=n}).fail(function(t){e.reject(t)}),e});return e};a.load=s;var r=function(){return a};e.exports=r},{"./promise.js":32}],28:[function(t,e,n){function i(e){var n=t("./dialog"),i=this,a=$.extend({text:"TEXT",info:"",OK:function(t){}},e);n.call(this,a);var o=function(){var e=t("./template.js"),n=doT.template(e.zcAlertTemplate)(a);i.setInner(n)};o()}e.exports=i},{"./dialog":29,"./template.js":30}],29:[function(t,e,n){function i(e){var n,i,a=t("./template.js"),o=this,s=$.extend({okText:"确定",title:"提示",inner:!1,OK:function(){}},e),r=function(){n=$(a.zcShadowLayer);var t=doT.template(a.zcModalOuter)(s);i=$(t)},u=function(t){i.find(".modal-body").append($(t))},d=function(){n.find(".fade.in").animate({opacity:0},300,function(){setTimeout(function(){n.remove()},100)})},l=function(){n.on("click",d),i.on("click",function(t){t.stopPropagation()}),i.delegate(".bootbox-close-button","click",d),i.delegate(".js-cancel-btn","click",function(t){s.cancel&&s.cancel(o),d()}),i.delegate(".js-ok-btn","click",function(t){d(),s.OK&&s.OK(o)})},c=function(){return i[0]},f=function(){l(),n.append(i),$(document.body).append(n),n.find(".fade.in").animate({opacity:1},300)},p=function(){r()};p(),this.getOuter=c,this.setInner=u,this.show=f,this.hide=d}e.exports=i},{"./template.js":30}],30:[function(t,e,n){var i={},a='<div class="zc-shadow-layer"></div>',o='<div class="bootbox  fade in" tabindex="-1" role="dialog" aria-hidden="false" style="display: block;outline:none;"><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><button type="button" class="bootbox-close-button close" data-dismiss="modal" aria-hidden="true">×</button><h4 class="modal-title">{{=it.title || "提示"}}</h4></div><div class="modal-body"></div>{{ if((it.footer !== false) ) { }}<div class="modal-footer"><button class="btn btn-danger js-cancel-btn">{{=it.cancelText || "取消"}}</button><button class="btn btn-success js-ok-btn">{{=it.okText || "确定"}}</button></div>{{ } }}</div></div></div>',s='<div class="modal-alert-content"><p class="large">{{=it.text}}</p><p>{{=it.info}}</p></div>';i.zcAlertTemplate=s,i.zcModalOuter=o,i.zcShadowLayer=a,e.exports=i},{}],31:[function(t,e,n){var i=0,a=1,o=2,s=function(t){console.log(t);var e=t.content||t.answer,n=/src=['"](.*?)['"]/;e.indexOf("<img")>=0?(e.indexOf("webchat_img_face")>=0?(t.message_type=i,t.desc="[表情]"):e.indexOf("webchat_img_upload")>=0&&(t.message_type=a,t.desc="[图片]"),n.test(e)&&(t.url=RegExp.$1)):e.indexOf("<audio")>=0||(t.message_type=o,t.desc=e)};e.exports=s},{}],32:[function(t,e,n){function i(){var t=[];this.resolve=function(e){var n=t.shift();n&&n.success&&"function"==typeof n.success&&n.success(e,this)},this.reject=function(e){var n=t.shift();n&&n.fail&&"function"==typeof n.fail&&n.fail(e,this)},this.then=function(e,n){return t.push({success:e,fail:n}),this}}i.when=function(t){return t()},e.exports=i},{}],33:[function(t,e,n){var i={initConfig:function(t,e){var n=this,i=t;n.saytext=i.saytext||"",n.Group=i.Group||"",n.faceGroup=i.faceGroup||"",n.emojiGroup=i.emojiGroup||"",n.emotion=i.emotion||"",n.saytext=i.saytext||"",n.path=i.path||"",n.emojiPath=i.emojiPath||"",n.tip={"/微笑":"weixiao","/伤心":"shangxin","/美女":"meinv","/发呆":"fadai","/墨镜":"mojing","/大哭":"daku","/羞":"xiu","/哑":"ya","/睡":"shui","/哭":"ku","/囧":"jiong","/怒":"nu","/调皮":"tiaopi","/憨笑":"hanxiao","/惊讶":"jingya","/难过":"nanguo","/炫酷+":"xuanku","/冷汗":"lenghan","/抓狂":"zhuakuang","/吐":"tu","/笑":"xiao","/可爱":"keai","/白眼":"baiyan","/傲":"ao","/饿":"e","/累":"lei","/惊恐":"jingkong","/汗":"han","/闲":"xian","/努力":"nuli","/骂":"ma","/疑问":"yiwen","/秘密":"mimi","/乱":"luan","/疯":"feng","/鬼":"gui","/打击":"daji","/拜":"bye","/无语":"wuyu","/抠":"kou","/鼓掌":"guzhang","/糟糕":"zaogao","/恶搞":"egao","/左哼哼":"zuohengheng","/右哼哼":"youhengheng","/困":"kun","/鄙视":"kan","/委屈":"weiqu","/坏":"huai","/亲":"qin","/吓":"xia","/可怜":"kelian","/刀":"dao","/水果":"shuiguo","/酒":"jiu","/篮球":"lanqiu","/乒乓":"pingpang","/咖啡":"kafei","/美食":"meishi","/猪":"dongwu","/鲜花":"xianhua","/枯萎":"kuwei","/唇":"chun","/心":"xin","/分手":"fenshou","/生日":"shengri","/电":"dian","/炸弹":"zhadan","/匕首":"bishou","/足球":"zuqiu","/虫":"chong","/臭":"chou","/月亮":"yueliang","/太阳":"taiyang","/礼物":"liwu","/伙伴":"huoban","/赞":"zan","/茶":"cha","/握手":"woshou","/优":"you","/恭":"gong","/勾引":"gouyin","/拳头":"quantou","/差劲":"chajin","/爱情":"aiqing","/不":"bu","/好的":"haode","/吻":"wen","/跳":"tiao","/怕":"pa","/尖叫":"jianjiao","/转圈圈":"quan","/拜":"bai","/回头":"huitou","/上下跳":"shangxiatiao","/天使":"tianshi","/激动":"jidong","/无":"wu","/瑜伽":"yujia","/太极":"taiji"},n.tip2={"/::)":"weixiao","/::~":"shangxin","/::B":"meinv","/::|":"fadai","/:8-)":"mojing","/::<":"daku","/::$":"xiu","/::X":"ya","/::Z":"shui","/::'(":"ku","/::-|":"jiong","/::@":"nu","/::P":"tiaopi","/::D":"daxiao","/::O":"jingya","/::(":"nanguo","/::+":"xuanku","/:–b":"lenghan","/::Q":"zhuakuang","/::T":"tu","/:,@P":"xiao","/:,@-D":"keai","/::d":"baiyan","/:,@o":"ao","/::g":"e","/:|-)":"lei","/::!":"jingkong","/::L":"han","/::>":"hanxiao","/::,@":"xian","/:,@f":"nuli","/::-S":"ma","/:?":"yiwen","/:,@x":"mimi","/:,@@":"luan","/::8":"feng","/:,@!":"ai","/:!!!":"gui","/:xx":"daji","/:bye":"bye","/:wipe":"wuyu","/:dig":"kou","/:handclap":"guzhang","/:&-(":"zaogao","/:B-)":"egao","/:<@":"zuohengheng","/:@>":"youhengheng","/::-O":"kun","/:>-|":"kan","/:P-(":"weiqu","/:X-)":"huai","/::*":"qin","/:@x":"xia","/:8*":"kelian","/:pd":"dao","/:<W>":"shuiguo","/:beer":"jiu","/:basketb":"lanqiu","/:oo":"pingpang","/:coffee":"kafei","/:eat":"meishi","/:pig":"dongwu","/:rose":"xianhua","/:showlove":"chun","/:heart":"xin","/:break":"fenshou","/:cake":"shengri","/:li":"dian","/:bome":"zhadan","/:kn":"bishou","/:footb":"zuqiu","/:ladybug":"chong","/:shit":"chou","/:moon":"yueliang","/:sun":"taiyang","/:gift":"liwu","/:hug":"huoban","/:strong":"zan","/:weak":"cha","/:share":"woshou","/:v":"you","/:@)":"gong","/:jj":"gouyin","/:@@":"quantou","/:bad":"chajin","/:lvu":"aiqing","/:no":"bu","/:ok":"haode","/:<L>":"wen","/:jump":"tiao","/:shake":"pa","/:<O>":"jianjiao","/:circle":"quan","/:kotow":"bai","/:turn":"huitou","/:skip":"shangxiatiao","/:oY":"tianshi","/:#-0":"jidong","/:hiphot":"wu","/:kiss":"chuanqing","/:<&":"yujia","/:&>":"taiji","/微笑":"weixiao","/伤心":"shangxin","/美女":"meinv","/发呆":"fadai","/墨镜":"mojing","/大哭":"daku","/羞":"xiu","/哑":"ya","/睡":"shui","/哭":"ku","/囧":"jiong","/怒":"nu","/调皮":"tiaopi","/憨笑":"hanxiao","/惊讶":"jingya","/难过":"nanguo","/炫酷+":"xuanku","/冷汗":"lenghan","/抓狂":"zhuakuang","/吐":"tu","/笑":"xiao","/可爱":"keai","/白眼":"baiyan","/傲":"ao","/饿":"e","/累":"lei","/惊恐":"jingkong","/汗":"han","/闲":"xian","/努力":"nuli","/骂":"ma","/疑问":"yiwen","/秘密":"mimi","/乱":"luan","/疯":"feng","/鬼":"gui","/打击":"daji","/拜":"bye","/无语":"wuyu","/抠":"kou","/鼓掌":"guzhang","/糟糕":"zaogao","/恶搞":"egao","/左哼哼":"zuohengheng","/右哼哼":"youhengheng","/困":"kun","/鄙视":"kan","/委屈":"weiqu","/坏":"huai","/亲":"qin","/吓":"xia","/可怜":"kelian","/刀":"dao","/水果":"shuiguo","/酒":"jiu","/篮球":"lanqiu","/乒乓":"pingpang","/咖啡":"kafei","/美食":"meishi","/猪":"dongwu","/鲜花":"xianhua","/枯萎":"kuwei","/唇":"chun","/心":"xin","/分手":"fenshou","/生日":"shengri","/电":"dian","/炸弹":"zhadan","/匕首":"bishou","/足球":"zuqiu","/虫":"chong","/臭":"chou","/月亮":"yueliang","/太阳":"taiyang","/礼物":"liwu","/伙伴":"huoban","/赞":"zan","/茶":"cha","/握手":"woshou","/优":"you","/恭":"gong","/勾引":"gouyin","/拳头":"quantou","/差劲":"chajin","/爱情":"aiqing","/不":"bu","/好的":"haode","/吻":"wen","/跳":"tiao","/怕":"pa","/尖叫":"jianjiao","/转圈圈":"quan","/拜":"bai","/回头":"huitou","/上下跳":"shangxiatiao","/天使":"tianshi","/激动":"jidong","/无":"wu","/瑜伽":"yujia","/太极":"taiji"},n.emojiTip=["1f600","1f601","1f602","1f603","1f604","1f605","1f606","1f607","1f608","1f609","1f610","1f611","1f612","1f613","1f614","1f615","1f616","1f617","1f618","1f619","1f620","1f621","1f622","1f623","1f624","1f625","1f626","1f627","1f628","1f629","1f630","1f631","1f632","1f633","1f634","1f635","1f636","1f637","1f42c","1f42d","1f42e","1f42d","1f42f","1f43a","1f43b","1f43c","1f44a","1f44b","1f44c","1f44d","1f44e","1f44f","1f47b","1f47d","1f47f","1f60a","1f60b","1f60c","1f60d","1f60e","1f60f","1f61a","1f61b","1f61c","1f61d","1f61e","1f61f","1f62a","1f62b","1f62c","1f62d","1f62e","1f62f","1f64f","1f345","1f370","1f414","1f424","1f426","1f427","1f428","1f430","1f431","1f433","1f434","1f435","1f436","1f437","1f438","1f439","1f440","1f446","1f447","1f448","1f449","1f450","1f466","1f467","1f491","1f680","1f681","1f685","2b55","26a0","263a","274c","2122","2600","2728","00a9","00ae","1f3c1","1f4ab","1f6b2","1f34e"],n.reg=/\/::\)|\/::~|\/::B|\/::\||\/:8-\)|\/::<|\/::\$|\/::X|\/::Z|\/::'\(|\/::-\||\/::@|\/::P|\/::D|\/::O|\/::\(|\/::\+|\/:–b|\/::Q|\/::T|\/:,@P|\/:,@-D|\/::d|\/:,@o|\/::g|\/:\|-\)|\/::!|\/::L|\/::>|\/::,@|\/:,@f|\/::-S|\/:\?|\/:,@x|\/:,@@|\/::8|\/:,@!|\/:!!!|\/:xx|\/:bye|\/:wipe|\/:dig|\/:handclap|\/:&-\(|\/:B-\)|\/:<@|\/:@>|\/::-O|\/:>-\||\/:P-\(|\/::'\||\/:X-\)|\/::\*|\/:@x|\/:8\*|\/:pd|\/:<W>|\/:beer|\/:basketb|\/:oo|\/:coffee|\/:eat|\/:pig|\/:rose|\/:fade|\/:showlove|\/:heart|\/:break|\/:cake|\/:li|\/:bome|\/:kn|\/:footb|\/:ladybug|\/:shit|\/:moon|\/:sun|\/:gift|\/:hug|\/:strong|\/:weak|\/:share|\/:v|\/:@\)|\/:jj|\/:@@|\/:bad|\/:lvu|\/:no|\/:ok|\/:love|\/:<L>|\/:jump|\/:shake|\/:<O>|\/:circle|\/:kotow|\/:turn|\/:skip|\/:oY|\/:#-0|\/:hiphot|\/:kiss|\/:<&|\/:&>|\/微笑|\/伤心|\/美女|\/发呆|\/墨镜|\/大哭|\/羞|\/哑|\/睡|\/哭|\/囧|\/怒|\/调皮|\/憨笑|\/惊讶|\/难过|\/炫酷|\/冷汗|\/抓狂|\/吐|\/笑|\/可爱|\/白眼|\/傲|\/饿|\/累|\/惊恐|\/汗|\/高兴|\/闲|\/努力|\/骂|\/疑问|\/秘密|\/乱|\/疯|\/鬼|\/打击|\/拜|\/无语|\/抠|\/鼓掌|\/糟糕|\/恶搞|\/左哼哼|\/右哼哼|\/困|\/鄙视|\/委屈|\/坏|\/亲|\/吓|\/可怜|\/刀|\/水果|\/酒|\/篮球|\/乒乓|\/咖啡|\/美食|\/猪|\/鲜花|\/枯萎|\/唇|\/心|\/分手|\/生日|\/电|\/炸弹:|\/匕首|\/足球|\/虫|\/臭|\/月亮|\/太阳|\/礼物|\/伙伴|\/赞|\/茶|\/握手|\/优|\/恭|\/勾引|\/拳头|\/差劲|\/爱情|\/不|\/好的|\/吻|\/跳|\/怕|\/尖叫|\/转圈圈|\/拜|\/回头|\/上下跳|\/天使|\/激动|\/无|\/传情|\/瑜伽|\/太极/g,n.reg2=/\/::\)|\/::~|\/::B|\/::\||\/:8-\)|\/::<|\/::\$|\/::X|\/::Z|\/::'\(|\/::-\||\/::@|\/::P|\/::D|\/::O|\/::\(|\/::\+|\/:–b|\/::Q|\/::T|\/:,@P|\/:,@-D|\/::d|\/:,@o|\/::g|\/:\|-\)|\/::!|\/::L|\/::>|\/::,@|\/:,@f|\/::-S|\/:\?|\/:,@x|\/:,@@|\/::8|\/:,@!|\/:!!!|\/:xx|\/:bye|\/:wipe|\/:dig|\/:handclap|\/:&-\(|\/:B-\)|\/:<@|\/:@>|\/::-O|\/:>-\||\/:P-\(|\/::'\||\/:X-\)|\/::\*|\/:@x|\/:8\*|\/:pd|\/:<W>|\/:beer|\/:basketb|\/:oo|\/:coffee|\/:eat|\/:pig|\/:rose|\/:fade|\/:showlove|\/:heart|\/:break|\/:cake|\/:li|\/:bome|\/:kn|\/:footb|\/:ladybug|\/:shit|\/:moon|\/:sun|\/:gift|\/:hug|\/:strong|\/:weak|\/:share|\/:v|\/:@\)|\/:jj|\/:@@|\/:bad|\/:lvu|\/:no|\/:ok|\/:love|\/:<L>|\/:jump|\/:shake|\/:<O>|\/:circle|\/:kotow|\/:turn|\/:skip|\/:oY|\/:#-0|\/:hiphot|\/:kiss|\/:<&|\/:&>|\/微笑|\/伤心|\/美女|\/发呆|\/墨镜|\/大哭|\/羞|\/哑|\/睡|\/哭|\/囧|\/怒|\/调皮|\/憨笑|\/惊讶|\/难过|\/炫酷|\/冷汗|\/抓狂|\/吐|\/笑|\/可爱|\/白眼|\/傲|\/饿|\/累|\/惊恐|\/汗|\/高兴|\/闲|\/努力|\/骂|\/疑问|\/秘密|\/乱|\/疯|\/鬼|\/打击|\/拜|\/无语|\/抠|\/鼓掌|\/糟糕|\/恶搞|\/左哼哼|\/右哼哼|\/困|\/鄙视|\/委屈|\/坏|\/亲|\/吓|\/可怜|\/刀|\/水果|\/酒|\/篮球|\/乒乓|\/咖啡|\/美食|\/猪|\/鲜花|\/枯萎|\/唇|\/心|\/分手|\/生日|\/电|\/炸弹:|\/匕首|\/足球|\/虫|\/臭|\/月亮|\/太阳|\/礼物|\/伙伴|\/赞|\/茶|\/握手|\/优|\/恭|\/勾引|\/拳头|\/差劲|\/爱情|\/不|\/好的|\/吻|\/跳|\/怕|\/尖叫|\/转圈圈|\/拜|\/回头|\/上下跳|\/天使|\/激动|\/无|\/传情|\/瑜伽|\/太极/,n.emojiReg=/(1f600|1f601|1f602|1f603|1f604|1f605|1f606|1f607|1f608|1f609|1f610|1f611|1f612|1f613|1f614|1f615|1f616|1f617|1f618|1f619|1f620|1f621|1f622|1f623|1f624|1f625|1f626|1f627|1f628|1f629|1f630|1f631|1f632|1f633|1f634|1f635|1f636|1f637|1f42c|1f42d|1f42e|1f42f|1f43a|1f43b|1f43c|1f44a|1f44b|1f44c|1f44d|1f44e|1f44f|1f47b|1f47d|1f47f|1f60a|1f60b|1f60c|1f60d|1f60e|1f60f|1f61a|1f61b|1f61c|1f61d|1f61e|1f61f|1f62a|1f62b|1f62c|1f62d|1f62e|1f62f|1f64f|1f345|1f370|1f414|1f424|1f426|1f427|1f428|1f430|1f431|1f433|1f434|1f435|1f436|1f437|1f438|1f439|1f440|1f446|1f447|1f448|1f449|1f450|1f466|1f467|1f491|1f680|1f681|1f685|2b55|26a0|263a|274c|2122|2600|2728|00a9|00ae|1f3c1|1f4ab|1f6b2|1f34e)/g;for(var a in n.tip){var o=new Image;o.src=n.path+n.tip[a]+".gif"}},show:function(){var t=this,e="";if($("#faceBox").length<=0){e='<div id="faceBox" class="face"><ul>';for(var n in t.tip)e+='<li><img class="faceIco" src="'+t.path+t.tip[n]+'.gif" data-src="'+n+'" /></li>';e+="</ul></div>",$(t.faceGroup).append(e)}t.sendTotextArea(t.saytext)},emojiShow:function(){var t=this,e="";if($("#emojiBox").length<=0){e='<div id="emojiBox" class="face"><ul>';for(var n=0;n<=t.emojiTip.length-1;n++)e+='<li><img class="faceIco" src="'+t.emojiPath+t.emojiTip[n]+'.png" data-src="'+t.emojiTip[n]+'" /></li>';e+="</ul></div>",$(emojiGroup).append(e)}t.isHidden(),t.emojiSendTotextArea(t.saytext)},isHidden:function(){var t=this;"block"==$(t.Group).css("display")?$(t.Group).css("display","none"):$(t.Group).css("display","block"),$(t.saytext).focus(function(){$(t.Group).hide()})},sendTotextArea:function(){var t=this;$(document.body).undelegate(),$(document.body).delegate(".faceIco","click",function(e){var n=e.currentTarget,i=$(n).attr("data-src"),a=$(t.saytext).val()+i;$(t.saytext).val(""),$(t.saytext).val(a),$(t.Group).hide()})},emojiSendTotextArea:function(){var t=this;$(document.body).undelegate(),$(document.body).delegate(".faceIco","click",function(e){var n=e.currentTarget,i=$(n).attr("data-src"),a=$(t.saytext).val()+i;$(t.saytext).val(""),$(t.saytext).val(a),$(t.Group).hide(),$(t.saytext).focus()})},analysis:function(t){var e=this,n=t.match(e.reg);if(n)for(var i=0;i<n.length;i++){var a=e.reg2.exec(t);t=t.replace(e.reg2,'<img src="'+e.path+e.tip2[a[0]]+'.gif" border="0" />',1)}return t=t.replace(e.emojiReg,'<img style="width:24px;height:24px;" src="'+e.emojiPath+'$1.png" border="0" />')},hasEmotion:function(t){return this.reg.test(t)||this.emojiReg.test(t)}};e.exports=i},{}],34:[function(require,module,exports){function addEvent(t,e,n){if(t.addEventListener)t.addEventListener(e,n,!1);else{if(!t.attachEvent)throw new Error("not supported or DOM not loaded");t.attachEvent("on"+e,function(){n.call(t)})}}function addResizeEvent(t){var e;addEvent(window,"resize",function(){e&&clearTimeout(e),e=setTimeout(t,100)})}function getBox(t){var e,n,i,a,o=getOffset(t);return e=o.left,i=o.top,n=e+t.offsetWidth,a=i+t.offsetHeight,{left:e,right:n,top:i,bottom:a}}function addStyles(t,e){for(var n in e)e.hasOwnProperty(n)&&(t.style[n]=e[n])}function copyLayout(t,e){var n=getBox(t);addStyles(e,{position:"absolute",left:n.left+"px",top:n.top+"px",width:t.offsetWidth+"px",height:t.offsetHeight+"px"})}function fileFromPath(t){return t.replace(/.*(\/|\\)/,"")}function getExt(t){return-1!==t.indexOf(".")?t.replace(/.*[.]/,""):""}function hasClass(t,e){var n=new RegExp("\\b"+e+"\\b");return n.test(t.className)}function addClass(t,e){hasClass(t,e)||(t.className+=" "+e)}function removeClass(t,e){var n=new RegExp("\\b"+e+"\\b");t.className=t.className.replace(n,"")}function removeNode(t){t.parentNode.removeChild(t)}function placeholder(t){-1==navigator.userAgent.indexOf("WebKit")&&(t.onfocus=function(){$(t).attr("placeholder")==$(t).val()&&(t.value="");
},t.onblur=function(){""==t.value&&(t.value=$(t).attr("placeholder"))})}if(document.documentElement.getBoundingClientRect)var getOffset=function(t){var e=t.getBoundingClientRect(),n=t.ownerDocument,i=n.body,a=n.documentElement,o=a.clientTop||i.clientTop||0,s=a.clientLeft||i.clientLeft||0,r=1;if(i.getBoundingClientRect){var u=i.getBoundingClientRect();r=(u.right-u.left)/i.clientWidth}r>1&&(o=0,s=0);var d=e.top/r+(window.pageYOffset||a&&a.scrollTop/r||i.scrollTop/r)-o,l=e.left/r+(window.pageXOffset||a&&a.scrollLeft/r||i.scrollLeft/r)-s;return{top:d,left:l}};else var getOffset=function(t){var e=0,n=0;do e+=t.offsetTop||0,n+=t.offsetLeft||0,t=t.offsetParent;while(t);return{left:n,top:e}};var toElement=function(){var t=document.createElement("div");return function(e){t.innerHTML=e;var n=t.firstChild;return t.removeChild(n)}}(),getUID=function(){var t=0;return function(){return"ValumsAjaxUpload"+t++}}(),AjaxUpload=function(t,e){this._settings={action:"upload.php",name:"userfile",multiple:!1,data:{},autoSubmit:!0,responseType:!1,hoverClass:"hover",focusClass:"focus",disabledClass:"disabled",onChange:function(t,e){},onSubmit:function(t,e){},onComplete:function(t,e){}};for(var n in e)e.hasOwnProperty(n)&&(this._settings[n]=e[n]);if(t.jquery?t=t[0]:"string"==typeof t&&(/^#.*/.test(t)&&(t=t.slice(1)),t=document.getElementById(t)),!t||1!==t.nodeType)throw new Error("Please make sure that you're passing a valid element");"A"==t.nodeName.toUpperCase()&&addEvent(t,"click",function(t){t&&t.preventDefault?t.preventDefault():window.event&&(window.event.returnValue=!1)}),this._button=t,this._input=null,this._disabled=!1,this.enable(),this._rerouteClicks()};AjaxUpload.prototype={setData:function(t){this._settings.data=t},disable:function(){addClass(this._button,this._settings.disabledClass),this._disabled=!0;var t=this._button.nodeName.toUpperCase();"INPUT"!=t&&"BUTTON"!=t||this._button.setAttribute("disabled","disabled"),this._input&&this._input.parentNode&&(this._input.parentNode.style.visibility="hidden")},enable:function(){removeClass(this._button,this._settings.disabledClass),this._button.removeAttribute("disabled"),this._disabled=!1},_createInput:function(){var t=this,e=document.createElement("input");e.setAttribute("type","file"),e.setAttribute("name",this._settings.name),this._settings.multiple&&e.setAttribute("multiple","multiple"),addStyles(e,{position:"absolute",right:0,margin:0,padding:"20px",fontFamily:"sans-serif",cursor:"pointer"});var n=document.createElement("div");if(addStyles(n,{display:"block",position:"absolute",overflow:"hidden",margin:0,padding:0,opacity:0,direction:"ltr",zIndex:2147483583}),"0"!==n.style.opacity){if("undefined"==typeof n.filters)throw new Error("Opacity not supported by the browser");n.style.filter="alpha(opacity=0)"}addEvent(e,"change",function(){if(e&&""!==e.value){var n=fileFromPath(e.value);return!1===t._settings.onChange.call(t,n,getExt(n))?void t._clearInput():void(t._settings.autoSubmit&&t.submit())}}),addEvent(e,"mouseover",function(){addClass(t._button,t._settings.hoverClass)}),addEvent(e,"mouseout",function(){removeClass(t._button,t._settings.hoverClass),removeClass(t._button,t._settings.focusClass),e.parentNode&&(e.parentNode.style.visibility="hidden")}),addEvent(e,"focus",function(){addClass(t._button,t._settings.focusClass)}),addEvent(e,"blur",function(){removeClass(t._button,t._settings.focusClass)}),n.appendChild(e),document.body.appendChild(n),this._input=e},_clearInput:function(){this._input&&(removeNode(this._input.parentNode),this._input=null,this._createInput(),removeClass(this._button,this._settings.hoverClass),removeClass(this._button,this._settings.focusClass))},_rerouteClicks:function(){var t=this;addEvent(t._button,"mouseover",function(){if(!t._disabled){t._input||t._createInput();var e=t._input.parentNode;copyLayout(t._button,e),e.style.visibility="visible"}})},_createIframe:function(){var t=getUID(),e=toElement('<iframe src="javascript:false;" name="'+t+'" />');return e.setAttribute("id",t),e.style.display="none",document.body.appendChild(e),e},_createForm:function(t){var e=this._settings,n=toElement('<form method="post" enctype="multipart/form-data"></form>');n.setAttribute("action",e.action),n.setAttribute("target",t.name),n.style.display="none",document.body.appendChild(n);for(var i in e.data)if(e.data.hasOwnProperty(i)){var a=document.createElement("input");a.setAttribute("type","hidden"),a.setAttribute("name",i),a.setAttribute("value",e.data[i]),n.appendChild(a)}return n},_getResponse:function(iframe,file){var toDeleteFlag=!1,self=this,settings=this._settings;addEvent(iframe,"load",function(){if("javascript:'%3Chtml%3E%3C/html%3E';"==iframe.src||"javascript:'<html></html>';"==iframe.src)return void(toDeleteFlag&&setTimeout(function(){removeNode(iframe)},0));var doc=iframe.contentDocument?iframe.contentDocument:window.frames[iframe.id].document;if(!(doc.readyState&&"complete"!=doc.readyState||doc.body&&"false"==doc.body.innerHTML)){var response;doc.XMLDocument?response=doc.XMLDocument:doc.body?(response=doc.body.innerHTML,settings.responseType&&"json"==settings.responseType.toLowerCase()&&(doc.body.firstChild&&"PRE"==doc.body.firstChild.nodeName.toUpperCase()&&(doc.normalize(),response=doc.body.firstChild.firstChild.nodeValue),response=response?eval("("+response+")"):{})):response=doc,settings.onComplete.call(self,file,response),toDeleteFlag=!0,iframe.src="javascript:'<html></html>';"}})},submit:function(){var t=this,e=this._settings;if(this._input&&""!==this._input.value){var n=fileFromPath(this._input.value);if(!1===e.onSubmit.call(this,n,getExt(n),this._input.files))return void this._clearInput();var i=this._createIframe(),a=this._createForm(i);removeNode(this._input.parentNode),removeClass(t._button,t._settings.hoverClass),removeClass(t._button,t._settings.focusClass),a.appendChild(this._input),a.submit(),removeNode(a),a=null,removeNode(this._input),this._input=null,this._getResponse(i,n),this._createInput()}}},module.exports=AjaxUpload},{}]},{},[7]);